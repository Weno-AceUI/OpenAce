<!DOCTYPE html>
<html>
<head>
    <title>OpenAce Control Center</title>
    <style>
        body { font-family: sans-serif; background: #f5f5f5; margin: 0; padding: 2em; }
        .panel { background: #fff; border-radius: 8px; padding: 2em; max-width: 400px; margin: auto; box-shadow: 0 2px 8px #0001; }
        .row { display: flex; align-items: center; margin-bottom: 1.5em; }
        .row label { flex: 1; }
        .toggle-btn { width: 60px; height: 32px; border-radius: 16px; background: #ddd; position: relative; cursor: pointer; }
        .toggle-btn.on { background: #4caf50; }
        .toggle-knob { width: 28px; height: 28px; border-radius: 50%; background: #fff; position: absolute; top: 2px; left: 2px; transition: left 0.2s; }
        .toggle-btn.on .toggle-knob { left: 30px; }
        .slider { width: 120px; }
    </style>
</head>
<body>
    <div class="panel">
        <h2>OpenAce Control Center</h2>
        <div id="toggles"></div>
        <div id="sliders"></div>
    </div>
    <script>
        async function fetchState() {
            const res = await fetch('/api/state');
            return await res.json();
        }
        async function toggle(idx) {
            await fetch('/api/toggle/' + idx, {method: 'POST'});
            render();
        }
        async function setSlider(idx, value) {
            await fetch('/api/slider/' + idx, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({value: value})
            });
            render();
        }
        async function render() {
            const state = await fetchState();
            const togglesDiv = document.getElementById('toggles');
            togglesDiv.innerHTML = '';
            state.toggles.forEach((t, i) => {
                const row = document.createElement('div');
                row.className = 'row';
                row.innerHTML = `<label>${t.name}</label>
                    <div class="toggle-btn${t.state ? ' on' : ''}" onclick="toggle(${i})">
                        <div class="toggle-knob"></div>
                    </div>`;
                togglesDiv.appendChild(row);
            });
            const slidersDiv = document.getElementById('sliders');
            slidersDiv.innerHTML = '';
            state.sliders.forEach((s, i) => {
                const row = document.createElement('div');
                row.className = 'row';
                row.innerHTML = `<label>${s.name}</label>
                    <input class="slider" type="range" min="0" max="100" value="${s.value}" 
                        oninput="setSlider(${i}, this.value)">
                    <span>${s.value}%</span>`;
                slidersDiv.appendChild(row);
            });
        }
        window.toggle = toggle;
        window.setSlider = setSlider;
        render();
    </script>
</body>
</html>